---
title: "Строим граф"
layout: def
categories: unity
impMath: true
excerpt: Checkout
---

# {{ page.title }}

делается прифаб точки

![](https://catlikecoding.com/unity/tutorials/basics/building-a-graph/creating-a-line-of-cubes/prefab-project-two-column.png)

далее, создаётся компонент графа

```
using UnityEngine;
public class Graph : MonoBehaviour {
  [SerializeField] Transform point;
  [SerializeField, Range(10, 100)] int resolution = 10;
  void Awake()
  {
    Vector3 position = default;
    float step = 2f / resolution;
    var scale = Vector3.one * step;
    for (int i = 0; i < resolution; ++i)
    {
      var newPoint = Instantiate(point);
      newPoint.SetParent(transform, false);
      position.x = (i + 0.5f) * step - 1f;
      position.y = f(position.x);
      newPoint.localPosition = position;
      newPoint.localScale = scale;
    }
  }
  float f(float x) => x;
  void Update()
  {
    Vector3 position = default;
    float step = 2f / resolution;
    var scale = Vector3.one * step;
    float time = Time.time;
    foreach (Transform point in transform)
    {
      position.x = point.localPosition;
      position.y = f(position.x, time);
      point.localPosition = position;
      point.localScale = scale;
    }
  }
  float f(float x, float t) => Mathf.Sin(Mathf.PI * (x + t));
}
```

![image](https://user-images.githubusercontent.com/43134602/153727666-f01fcae1-350d-4d19-a788-de12e0bbbc27.png)

а дальше, на прифаб точки просто добавляется материал с шейдером, цвет которого зависит от высоты объекта в пространстве

```
Shader "Unlit/Plot"
{
    Properties
    {
        _MainTex ("Texture", 2D) = "white" {}
        _MaxColor ("Max Color", Color) = (0,1,0,1)
        _MidColor ("Mid Color", Color) = (1,1,0,1)
        _MinColor ("Min Color", Color) = (1,0,0,1)
        _MaxHeight("Max Height",Float) = 10
        _MinHeight("Min Height",Float) = 0
    }
    SubShader
    {
        Tags { "RenderType"="Opaque" }
        LOD 100

        Pass
        {
            CGPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            // make fog work
            #pragma multi_compile_fog

            #include "UnityCG.cginc"

            struct appdata
            {
                float4 vertex : POSITION;
                float2 uv : TEXCOORD0;
            };

            struct v2f
            {
                float2 uv : TEXCOORD0;
                float4 color : COLOR;
                UNITY_FOG_COORDS(1)
                float4 vertex : SV_POSITION;
            };

            sampler2D _MainTex;
            float4 _MainTex_ST;
            float4 _MaxColor;
            float4 _MidColor;
            float4 _MinColor;
            float _MaxHeight;
            float _MinHeight;

            v2f vert (appdata v)
            {
                v2f o;
                o.vertex = UnityObjectToClipPos(v.vertex);
                o.uv = TRANSFORM_TEX(v.uv, _MainTex);
                float h = saturate((mul(unity_ObjectToWorld, v.vertex).y-_MinHeight)/(_MaxHeight-_MinHeight));
                o.color = lerp(_MinColor, lerp(_MidColor, _MaxColor, h), h);
                UNITY_TRANSFER_FOG(o,o.vertex);
                return o;
            }

            fixed4 frag (v2f i) : SV_Target
            {
                // sample the texture
                fixed4 col = tex2D(_MainTex, i.uv)*i.color;
                // apply fog
                UNITY_APPLY_FOG(i.fogCoord, col);
                return col;
            }
            ENDCG
        }
    }
}
```

![image](https://user-images.githubusercontent.com/43134602/153727623-8d8eb71e-995d-4b4a-b748-daad8aaaecab.png)

всё

граф готов


<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<title>Cursed fields - Permyakov&#39;s Blog</title>
<meta name="description" content="Unobvious Simple Arithmetic">
<meta name="viewport" content="width=device-width, initial-scale=1">



  <meta name="generator" content="Hugo 0.55.6" />
  
<meta itemprop="name" content="Cursed fields">
<meta itemprop="description" content="Unobvious Simple Arithmetic">


<meta itemprop="datePublished" content="2019-07-08T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-07-08T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="441">



<meta itemprop="keywords" content="" />

  <meta property="og:title" content="Cursed fields" />
<meta property="og:description" content="Unobvious Simple Arithmetic" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mogom.github.io/blog/cursed_fields/" />
<meta property="article:published_time" content="2019-07-08T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2019-07-08T00:00:00&#43;00:00"/>

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cursed fields"/>
<meta name="twitter:description" content="Unobvious Simple Arithmetic"/>

  

  <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
  
    
      <link rel="stylesheet" href="/css/normalize.css">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway:400,800,900|Source+Sans+Pro:400,700">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.1.0/css/flag-icon.min.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css">
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css" integrity="sha384-i1LQnF23gykqWXg6jxC2ZbCbUMxyw5gLZY6UiUS98LYV5unm8GWmfkIS6jqJfb4E" crossorigin="anonymous">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.css" />
      <link rel="stylesheet" href="/css/main.min.css">
      <link rel="stylesheet" href="/css/add-on.css">
    
  
  
  
  
  
</head>

  <body>
    
<header id="site-header">
  <nav id="site-nav">
    <h1 class="nav-title">
      <a href="/">
        
          
            Blog
          
        
      </a>
    </h1>
    <menu id="site-nav-menu" class="flyout-menu">
      
        <a href="/" class="link"><i class="fas fa-home">&nbsp;</i>Home</a>
      
        <a href="/about/" class="link"><i class="far fa-id-card">&nbsp;</i>About</a>
      
        <a href="/blog/" class="link"><i class="far fa-newspaper">&nbsp;</i>Blog</a>
      
        <a href="/categories/" class="link"><i class="fas fa-sitemap">&nbsp;</i>Categories</a>
      
        <a href="/contact/" class="link"><i class="far fa-envelope">&nbsp;</i>Contact</a>
      
      <a href="#share-menu" class="share-toggle"><i class="fas fa-share-alt">&nbsp;</i>Share</a>
      

    </menu>
    

    <a href="#share-menu" class="share-toggle"><i class="fas fa-share-alt fa-2x">&nbsp;</i></a>
    <a href="#lang-menu" class="lang-toggle" lang="en"><span class="flag-icon flag-icon-en" alt="en"></span></a>
    <a href="#site-nav" class="nav-toggle"><i class="fas fa-bars fa-2x"></i></a>
  </nav>
  <menu id="lang-menu" class="flyout-menu">
  <a href="#" lang="en" class="active"><span class="flag-icon flag-icon-en" alt="en"></span></a>
  
        <a href="https://mogom.github.io/ru/blog/cursed_fields/" lang="ru"><span class="flag-icon flag-icon-ru" alt="ru"></span></a>
    
  
</menu>

  
    <menu id="share-menu" class="flyout-menu">
      <h1>Share Post</h1>
      




  
    
    <a href="//twitter.com/share?text=Cursed%20fields&amp;url=https%3a%2f%2fmogom.github.io%2fblog%2fcursed_fields%2f" target="_blank" rel="noopener" class="share-btn twitter">
        <i class="fab fa-twitter"></i><p>&nbsp;Twitter</p>
      </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmogom.github.io%2fblog%2fcursed_fields%2f" target="_blank" rel="noopener" class="share-btn facebook">
        <i class="fab fa-facebook"></i><p>&nbsp;Facebook</p>
        </a>
  

  
    <a href="//www.reddit.com/submit?url=https%3a%2f%2fmogom.github.io%2fblog%2fcursed_fields%2f&amp;title=Cursed%20fields" target="_blank" rel="noopener" class="share-btn reddit">
          <i class="fab fa-reddit-alien"></i><p>&nbsp;Reddit</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fmogom.github.io%2fblog%2fcursed_fields%2f&amp;title=Cursed%20fields" target="_blank" rel="noopener" class="share-btn linkedin">
            <i class="fab fa-linkedin"></i><p>&nbsp;LinkedIn</p>
          </a>
  

  
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fmogom.github.io%2fblog%2fcursed_fields%2f&amp;description=Cursed%20fields" target="_blank" rel="noopener" class="share-btn pinterest">
          <i class="fab fa-pinterest-p"></i><p>&nbsp;Pinterest</p>
        </a>
  

  
        <a href="mailto:?subject=Check out this post by %7b%20%20%20%20%20%20%20%20map%5b%5d%7d&amp;body=https%3a%2f%2fmogom.github.io%2fblog%2fcursed_fields%2f" target="_blank" class="share-btn email">
          <i class="fas fa-envelope"></i><p>&nbsp;Email</p>
        </a>
  


    </menu>
  
</header>

    <div id="wrapper">
      <section id="site-intro">
  <a href="/"><img src="/img/main/logo.jpg" class="circle" width="" alt="Hugo Future Imperfect Slim" /></a>
  <header>
    <h1>Permyakov's Blog</h1>
  </header>
  <main>
    <p>Wake up buddy. We have a problem to solve.</p>
  </main>
  
    <footer>
      <ul class="social-icons">
        

        <li><a href="//github.com/mOgOm" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>

























<li><a href="//instagram.com/telega_staraya" target="_blank" rel="noopener" title="Instagram" class="fab fa-instagram"></a></li>





<li><a href="//telegram.me/meh_potato" target="_blank" rel="noopener" title="telegram" class="fab fa-telegram"></a></li>






<li><a href="mailto:c0_0b@mail.ru" target="_blank" title="Email" class="far fa-envelope"></a></li>

      </ul>
    </footer>
  
</section>

      <main id="site-main">
        <article class="post">
  <header>
  <div class="title">
    
        <h2><a href="/blog/cursed_fields/">Cursed fields</a></h2>
    
    
        <p>Unobvious Simple Arithmetic</p>
    
</div>
  <div class="meta">
    <time class="published" datetime="2019-07-08 00:00:00 &#43;0000 UTC">
      July 8, 2019
    </time>
    <span class="author">Mike Permyakov</span>
    
        <p>3 minute read</p>
    
  </div>
</header>

  <section id="social-share">
    




  
    
    <a href="//twitter.com/share?text=Cursed%20fields&amp;url=https%3a%2f%2fmogom.github.io%2fblog%2fcursed_fields%2f" target="_blank" rel="noopener" class="share-btn twitter">
        <i class="fab fa-twitter"></i><p>&nbsp;Twitter</p>
      </a>
  

  
      <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmogom.github.io%2fblog%2fcursed_fields%2f" target="_blank" rel="noopener" class="share-btn facebook">
        <i class="fab fa-facebook"></i><p>&nbsp;Facebook</p>
        </a>
  

  
    <a href="//www.reddit.com/submit?url=https%3a%2f%2fmogom.github.io%2fblog%2fcursed_fields%2f&amp;title=Cursed%20fields" target="_blank" rel="noopener" class="share-btn reddit">
          <i class="fab fa-reddit-alien"></i><p>&nbsp;Reddit</p>
        </a>
  

  
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fmogom.github.io%2fblog%2fcursed_fields%2f&amp;title=Cursed%20fields" target="_blank" rel="noopener" class="share-btn linkedin">
            <i class="fab fa-linkedin"></i><p>&nbsp;LinkedIn</p>
          </a>
  

  
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fmogom.github.io%2fblog%2fcursed_fields%2f&amp;description=Cursed%20fields" target="_blank" rel="noopener" class="share-btn pinterest">
          <i class="fab fa-pinterest-p"></i><p>&nbsp;Pinterest</p>
        </a>
  

  
        <a href="mailto:?subject=Check out this post by %7b%20%20%20%20%20%20%20%20map%5b%5d%7d&amp;body=https%3a%2f%2fmogom.github.io%2fblog%2fcursed_fields%2f" target="_blank" class="share-btn email">
          <i class="fas fa-envelope"></i><p>&nbsp;Email</p>
        </a>
  


  </section>
  
<a href="/blog/cursed_fields/" class="image featured">
  <img src="/img/2019/07/pic04.jpg" alt="Pic 4">
</a>


  <div class="content">
    

<p>The brave adventurer has arrived in strange fields.
It&rsquo;s shone with emerald light and time seemes to go faster and faster here.
The traveler look at his watch and see that the arrows are turning at a breakneck pace. It might be he got slower.</p>

<p>Suddenly he felt hunger and began to go even more slower.</p>

<p>&hellip;</p>

<p>But&hellip; look at that&hellip; Here it is the boundary of the field.
Green light begins to fade, but hunger is still here.
On the horizon looming apple tree. The rescue.
Having a tight bite of apples, the traveler feels that hunger is receding.
Now he can continue on his way.</p>

<h3 id="how-we-can-reach-the-same-experience">How we can reach the same experience?</h3>

<p>Let&rsquo;s consider that we have a constatnt <em>V</em> that represent starting velocity of the adventurer, and a variable <em>Vc</em> thet represent current velocity. The map under study is as follows:</p>

<pre><code>field_starts   hunger_starts   field_ends    hunger_ends
(:             [               :)            ]
</code></pre>

<p>Moreover, we have events:</p>

<ul>
<li>field_starts</li>
<li>field_ends</li>
<li>hunger_starts</li>
<li>hunger_ends</li>
</ul>

<p>that arrives when adventurer getting to/out the fields and starting/ending hunger and we know what kind of effects velocity gets from starting feeling hunger or getting to the fields. For example:</p>

<ul>
<li>when adventurer gets in fields, his speed is decreases five times</li>
<li>when adventurer starting hunger, his speed down with three points</li>
</ul>

<p>So, what if we need to build the system that will tell us what is equal to <em>Vc</em>? How would we handle this?</p>

<p>The first and most common idea that arrival is to use direct and inverse operations on demand:</p>

<pre><code class="language-cpp">void start () {Vc = V;}
void update (Event event)
{
    if (event == field_starts) Vc /= 5;
    if (event == field_ends) Vc *= 5;
    if (event == hunger_starts) Vc -= 3;
    if (event == hunger_ends) Vc += 3;
}
</code></pre>

<p>So, job is done aaaand we failed. We can&rsquo;t combine operations from different classes like that. For example, let <em>V</em> is <code>10</code>. After this trip speed of the traveler would be <code>(((10 / 5) - 3) * 5) + 3 == -2</code> which is a really bad result.</p>

<h3 id="whatammma-gonna-do">WHATAMMMA GONNA DO??</h3>

<p>Well we could use contract that determines the order of applying effects and some hash table that contain information of which effects are currently active. So working solution may look like this:</p>

<pre><code class="language-cpp">void update(Event event)
{
    static map&lt;event, pair&lt;bool,function&lt;(void)void&gt; &gt; &gt; states {
        { field_effect,  {false, [&amp;Vc](){Vc *= 5;} } },
        { hunger_effect, {false, [&amp;Vc](){Vc += 3;} } },
    };

    static vector&lt;event&gt; effects {
        field_effect,
        hunger_effect,
    };

    Vc = V;
    for (auto&amp; it : effects) {
        if (event == it) states[it].first = !states[it].first;
        if (states[it].first) states[it].second ();
    }
}
</code></pre>

<p>And it works.</p>

<p>That&rsquo;s all. Thank you for reading.</p>

  </div>
  <footer>
    <ul class="stats">
  
    
    
      <li class="categories">
        <ul>
          
            
            <li><a class="article-category-link" href="https://mogom.github.io/categories/gamedev">gamedev</a></li>
          
            
            <li><a class="article-category-link" href="https://mogom.github.io/categories/math">math</a></li>
          
        </ul>
      </li>
    
  
  
    <li class="tags">
      <ul>
        <li>None</li>
      </ul>
    </li>
  
</ul>

  </footer>
</article>
<article class="post">
  

</article>
<div class="pagination">
  
    <a href="/blog/examples/" class="button big previous"><i class="fas fa-angle-left"></i> Markdown and Shortcodes</a>
  
  
</div>


      </main>
      <section id="site-sidebar">
  
    <section id="recent-posts">
      <header>
        <h1>Recent posts</h1>
      </header>
      
      <article class="mini-post">
        <section>
          
<a href="/blog/cursed_fields/" class="image featured">
  <img src="/img/2019/07/pic04.jpg" alt="Pic 4">
</a>


        </section>
        <header>
          <h1><a href="/blog/cursed_fields/">Cursed fields</a></h1>
          <time class="published" datetime="">July 8, 2019</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          

        </section>
        <header>
          <h1><a href="/blog/examples/">Markdown and Shortcodes</a></h1>
          <time class="published" datetime="">January 1, 2019</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
<a href="/blog/creating-a-new-theme/" class="image featured">
  <img src="/img/2014/09/pic03.jpg" alt="Pic 3">
</a>


        </section>
        <header>
          <h1><a href="/blog/creating-a-new-theme/">Creating a New Theme</a></h1>
          <time class="published" datetime="">September 28, 2014</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
<a href="/blog/goisforlovers/" class="image featured">
  <img src="/img/2014/04/pic02.jpg" alt="Pic 2">
</a>


        </section>
        <header>
          <h1><a href="/blog/goisforlovers/">(Hu)go Template Primer</a></h1>
          <time class="published" datetime="">April 2, 2014</time>
        </header>
      </article>
      
      <article class="mini-post">
        <section>
          
<a href="/blog/hugoisforlovers/" class="image featured">
  <img src="/img/2014/04/pic01.jpg" alt="Pic 1">
</a>


        </section>
        <header>
          <h1><a href="/blog/hugoisforlovers/">Getting Started with Hugo</a></h1>
          <time class="published" datetime="">April 2, 2014</time>
        </header>
      </article>
      
      
        <a href="/blog/" class="button">See more</a>
      
    </section>
  

  
    
      <section id="categories">
        <header>
          <h1><a href="/categories">Categories</a></h1>
        </header>
        <ul>
          
            
          
          
          <li>
            
              <a href="/categories/hugo/">hugo<span class="count">3</span></a>
            
          
          <li>
            
              <a href="/categories/gamedev/">gamedev<span class="count">1</span></a>
            
          
          <li>
            
              <a href="/categories/go/">go<span class="count">1</span></a>
            
          
          <li>
            
              <a href="/categories/jekyll/">jekyll<span class="count">1</span></a>
            
          
          <li>
            
              <a href="/categories/markdown/">markdown<span class="count">1</span></a>
            
          
          <li>
            
              <a href="/categories/math/">math<span class="count">1</span></a>
            
          
          </li>
        </ul>
      </section>
    
  

  <section id="mini-bio">
    <header>
      <h1>About</h1>
    </header>
    <p>test</p>
    <footer>
      <a href="/about" class="button">Learn More</a>
    </footer>
  </section>
</section>

      <footer id="site-footer">
  
      <ul class="social-icons">
        

        <li><a href="//github.com/mOgOm" target="_blank" rel="noopener" title="GitHub" class="fab fa-github"></a></li>

























<li><a href="//instagram.com/telega_staraya" target="_blank" rel="noopener" title="Instagram" class="fab fa-instagram"></a></li>





<li><a href="//telegram.me/meh_potato" target="_blank" rel="noopener" title="telegram" class="fab fa-telegram"></a></li>






<li><a href="mailto:c0_0b@mail.ru" target="_blank" title="Email" class="far fa-envelope"></a></li>

      </ul>
  
  <p class="copyright">
    
      &copy; 2019
      
        Permyakov&#39;s Blog
      
    .
    Powered by <a href="//gohugo.io" target="_blank" rel="noopener">Hugo</a>
  </p>
</footer>
<a id="back-to-top" href="#" class="fas fa-arrow-up fa-2x"></a>

      
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/html.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/css.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/js.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/languages/toml.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>


  
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/skel/3.0.1/skel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.3.5/jquery.fancybox.min.js"></script>
  <script src=/js/util.js></script>
  <script src=/js/main.js></script>
  <script src=/js/add-on.js></script>
  



    </div>
  </body>
</html>
